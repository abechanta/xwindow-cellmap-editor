/*
// me.txt
*/

０．概要
    早い話「おきらくマップエディタ」です．機能はざっと以下の通りです．

	・マップデータを読み込んでマップの編集ができます．マップのサイズは
	  ２５６セル×２５６セル まで扱えます．
	・セルデータを読み込んでセルの編集ができます．セルのサイズは
	  ８ドット×８ドット です．
	・扱えるセルの数は２５６個で，色数は６４色です．
	・現段階(Ver.1.01)ではセルに使用する色の編集はできません（カラーデータ
	  を渡すことはできますが，カラーデータを編集することはできません）．

１．ファイル
    me は以下のファイルで構成されます．

	・me.c		me のソースプログラム．Ｃ言語で記述されています．
	・me.txt	このドキュメントファイルです．
	・~/.me_env	環境設定ファイルです．（自動的に作成されます）

２．起動方法

    コマンドライン上で

	% me [filename]

と入力することで マップエディタ me が起動されます．引数としてカラーファイルを
与えると，そのカラーデータを使っての編集ができます．詳しくは ４．の「データ
ファイルのフォーマットについて」を参照してください．

    また， .me_env（環境設定ファイル）が存在するときには，そのなかに保存して
ある環境設定を起動時に自動的に読み込みます．

３．操作方法

    起動に成功すると３つのウインドウが出現します．

	・メインウインドウ(MAP_EDITOR)
	    マップの編集は主にここで行います．また編集スイッチが用意されてい
	て編集効率の向上に役に立ちます．ウインドウの大きさを変えて編集画面を
	広げることができます．

	・情報ウインドウ(INFO)
	    マウスの位置やメッセージなど各種の情報を表示するほか，コマンドや
	ファイル名のキーボード入力ウインドウとしての役割もあります．

	・セルウインドウ(CELL)
	    セル番号やセルの出現頻度などセルに関する情報を表示します．またセ
	ルの選択およびセルの編集にも使われます．

    me の操作には

	・マウスによるクリック
	・キーボードによる文字入力
	・テンキーによる入力

の３種類があります．マウスによるダブルクリックやドラッグイングは必要ありませ
ん．以下に細かい操作説明をしますが基本的には

	・マウス１ボタンクリック	-> 決定
	・マウス２ボタンクリック	-> スポイト・スクロール
	・マウス３ボタンクリック	-> マーク
	・キーボードによる文字入力	-> ファイル名入力・コマンド入力
	・テンキーによる入力		-> スクロール

となっています．

＜マップ編集モード＞

    編集開始時の基本状態です．以下の操作が行えます．

	｛メインウインドウ｝
	・マップ部を１ボタンクリック ->
		カレントセル（現在選んでいるセル）をカーソル位置にプットする．
	・マップ部を２ボタンクリック ->
		マップスクロールする．ただし
			１）マップ部中央でクリック
			２）スクロール限界
			３）スクロール幅が０
		のいずれかのときには，マップスクロールせずにカーソル位置のセ
		ルをカレントセルにセットする．
	・マップ部を３ボタンクリック ->
		マークセット．マークは２つまでセットでき（マークＳとマークＤ）
		編集作業の対象範囲などを設定するものである．ただしマークＳと
		マークＤが同じ位置のときには，例外的にマップ全体が対象範囲に
		なる．
	・スイッチ部を１ボタンクリック ->
		スイッチの機能を呼び出す．スイッチによってはマップ編集モード
		から抜けて，別モードに移行するものもある．
		（機能については３．の「スイッチの機能」を参照してください）
	・テンキー入力 ->
		マップスクロールする（１／２画面）．

	｛情報ウインドウ｝
	・１ または ２ボタンクリック ->
		現在のズーム・スクロール幅・セルパーティション設定を表示する．
	・３ボタンクリック ->
		現在のマーク（Ｓ・Ｄ）・マークセルの設定を表示する．

	｛セルウインドウ｝
	・リスト部を１ボタンクリック ->
		カーソル位置のセルをカレントセルにセットする．
	・リスト部を２ボタンクリック ->
		セルリスト表示のスクロールをする．
	・リスト部を３ボタンクリック ->
		マークセルのセットをする．
	・セル情報部を１ボタンクリック ->
		現在のマップにおけるセルの出現数を集計する．
	・セル編集中に
		・セル編集部を１ボタンクリック ->
			カレントカラー（現在選んでいるカラー）をカーソル位置に
			プットする．
		・セル編集部を２ボタンクリック ->
			カーソル位置のカラーをカレントカラーにセットする．
		・セル編集部を３ボタンクリック ->
			マークセルをセル編集部にプットする．
		・カラー選択部を１ボタンクリック ->
			カーソル位置のカラーをカレントカラーにセットする．
		・「Ｏ．Ｋ．」部を１ボタンクリック ->
			セル編集の終了．編集中のセルが新しく更新される．

＜キーボード入力モード＞

    キーボードで文字列を入力するモードです．

	｛メインウインドウ｝
	・１ または ２ または ３ボタンクリック ->
		キーボード入力モードの強制終了（キャンセル）．

	｛情報ウインドウ｝
	・２ボタンクリック ->
		バッファのクリア．
	・キーボード入力後 改行 ->
		キーボード入力モードの終了．

＜終了確認モード＞

    編集作業の終了を確認するモードです．

	｛メインウインドウ｝
	・１ または ２ または ３ボタンクリック ->
		終了確認モードの強制終了（キャンセル）．

	｛情報ウインドウ｝
	・「Ｏ．Ｋ．」部を１ボタンクリック ->
		終了確認モードの終了．編集作業を終了する．

・スイッチの機能

    以下にスイッチの機能を紹介します．

＜MAP LOAD＞
	マップファイルをロードします．-> キーボード入力モード
＜MAP SAVE＞
	現在のマップデータをマップファイルにセーブします．
							-> キーボード入力モード
＜MAP YANK＞
	マークＳからマークＤまでの矩形領域をカットバッファに記憶します．
＜MAP PASTE＞
	カットバッファの内容をマークＳの位置にプットします．

＜CELL LOAD＞
	セルファイルをロードします．-> キーボード入力モード
＜CELL SAVE＞
	現在のセルデータをセルファイルにセーブします．	-> キーボード入力モード
＜CELL ATTR＞
	カレントセルに属性名を与えます．-> キーボード入力モード
＜CELL EDIT＞
	カレントセルの編集を開始します．

＜ZOOM＞
	ズーム倍率を変更します．
＜SCROLL＞
	スクロール幅を変更します．
＜PART＞
	セルパーティションを変更します．
＜ENV SAVE＞
	環境設定ファイルを更新します．
＜QUIT＞
	me を終了します．				-> 終了確認モード

＜MENU＞
	次のスイッチメニューを表示します．
＜COMMAND＞
	以下のコマンド入力を受け付けます．		-> キーボード入力モード

	＜map-load[mld]  filename.map＞
		マークＳの位置にマップファイルをロードします．
	＜map-save[msv]  filename.map＞
		マークＳからマークＤまでの矩形領域をマップファイルにセーブし
		ます．
	＜map-box[mbox]＞
		マークＳからマークＤまでを対角線とする長方形を描画します．
	＜map-clear[mcls]＞
		マークＳからマークＤまでの矩形領域をセル番号０で塗りつぶしま
		す．
	＜map-fill[mfill]＞
		マークＳからマークＤまでの矩形領域をカレントセルで塗りつぶしま
                す．
	＜map-yank[mget]＞
		マークＳからマークＤまでの矩形領域をカットバッファに記憶しま
		す．（＜MAP YANK＞と同じ）
	＜map-paste[mput]＞
		カットバッファの内容をマークＳの位置にプットします．
		（＜MAP PASTE＞と同じ）
	＜map-replace[mrep]＞
		マークＳからマークＤまでの矩形領域の内で，カレントセルと同じ
		セルをマークセルに置き換えます．
	＜map-flip[mflip]  'h'or'v'or'hv'＞
		マークＳからマークＤまでの矩形領域を上下左右反転させます．
	＜cell-swap[cswap]＞
		マークセルとカレントセルのデータを入れ変えます．
	＜zoom[zm]  0~3＞
		ズームの度合いを決めます（0~3 がそれぞれ x1 x2 x4 x8 に対応）．
	＜scroll[scr]  0~24＞
		マウス２ボタンによるマップスクロールの幅を決めます．
	＜part[pt]  0~4＞
		セルパーティションの種類を決めます．
	＜jump[jp]  jump_x  jump_y＞
		指定座標のマップを表示します．
	＜color-file[col]  filename.col＞
		次の起動時のカラーファイルを設定します（デフォルトは NONE）．
	＜window-main[w0]  pos_x  pos_y＞
		メインウインドウの位置を変更します．
	＜window-info[w1]  pos_x  pos_y＞
		情報ウインドウの位置を変更します．
	＜window-cell[w2]  pos_x  pos_y＞
		セルウインドウの位置を変更します．
	＜help[h]＞
		コマンドの一覧を出力します．

４．補足

	・.me_env（環境設定ファイル）の書式について

	    .me_env は環境設定を行うファイルで，me 起動中に環境設定をして
	ENV SAVE スイッチを押すと作成されます．また，通常のテキストエディタで
	編集することも可能です．このファイルは各ユーザのホームディレクトリに
	置いておいてください．以下に宣言を紹介します．

	    ＜ZOOM＞
		説明
		    ズームの度合いを決める（0~3 がそれぞれ x1 x2 x4 x8 に対応）
		書式
			ZOOM		0~3

	    ＜SCROLL＞
		説明
		    マウス２ボタンによるマップスクロールの幅を決める
		書式
			SCROLL		0~24

	    ＜PART＞
		説明
		    セルパーティションの種類を決める
		書式
			PART		0~4

	    ＜COLOR_FILE＞
		説明
		    起動時のカラーファイルを設定する（デフォルトは NONE）
		書式
			COLOR_FILE	filename.col

	    ＜SIZE＞
		説明
		    メインウインドウの大きさを決める
		書式
			SIZE		size_x size_y

	    ＜WINDOW_0＞
		説明
		    メインウインドウの位置を決める
		書式
			WINDOW_0	pos_x pos_y

	    ＜WINDOW_1＞
		説明
		    情報ウインドウの位置を決める
		書式
			WINDOW_1	pos_x pos_y

	    ＜WINDOW_2＞
		説明
		    セルウインドウの位置を決める
		書式
			WINDOW_2	pos_x pos_y

	    ＜#＞
		説明
		    このコマンドから行末までをコメントとして扱う．
		書式
			#		this line is comment.

	    ＜END＞
		説明
		    環境設定ファイルの終端を表す．
		書式
			END

	・データファイルのフォーマットについて

	    me はデータファイルを作成しますが，これらのデータファイルのフォー
	マットはまったく勝手に考え出したものなので，me 以外で作られたデータを
	me で編集したい場合にはおそらくコンバータが必要になることと思います．
	その際の参考のために，以下に各データファイルのフォーマットを示します．

		・カラーファイル  （***.col）

		バイナリ形式．
		サイズは 64*3+1(改行) バイト（固定）．
		カラー番号０から順に ＲＧＢの輝度（０〜２５５）を保存したもの．

			R(0)G(0)B(0)R(1)G(1).......R(63)G(63)B(63)\n
			^_________________ 64組 _________________^

		・マップファイル  （***.map）

		ヘッダ部：テキスト形式．
		データ部：バイナリ形式．
		サイズは X(ヘッダ部)+1(改行)+width*height+1(改行) バイト．
		ヘッダ部は セル数width と セル数height を空白または改行で区切り
		データ部はマップ左上から右に走査しそのセル番号を保存したもの．

	ヘッダ部    -->	width height \n
		      >	m(0,0)m(1,0)m(2,0)m(3,0)......m(width-1,0)
		     |	m(0,1)m(1,1)m(2,1)m(3,1)......m(width-1,1)
	height個     |	   :     :     :     :                 :
		     |	   :     :     :     :                 :
		      >	m(0,height-1)m(1,height-1)....m(width-1,height-1)\n
			^______________ width個 _______________^


		・セルファイル    （***.cel）

		バイナリ形式．
		サイズは 256*8*8+1(改行) バイト（固定）．
		セル番号０から順に セルの左上から右に走査しそのカラー番号を
		保存したもの．

		      >	c(0,0,0)c(0,1,0)c(0,2,0)......c(0,7,0)
		     |	c(0,0,1)c(0,1,1)c(0,2,1)......c(0,7,1)
		 >8個|	   :       :       :             :
		|     >	c(0,0,7)c(0,1,7)c(0,2,7)......c(0,7,7)
		|	^______________ 8個 _____________^
		|
		|	c(1,0,0)c(1,1,0)c(1,2,0)......c(1,7,0)
	  256個	|	c(1,0,1)c(1,1,1)c(1,2,1)......c(1,7,1)
		|	   :       :       :             :
		|	   :       :       :             :
		|
		|	c(255,0,0)c(255,1,0)c(255,2,0)......c(255,7,0)
		|	c(255,0,1)c(255,1,1)c(255,2,1)......c(255,7,1)
		 >	     :         :         :               :
			c(255,0,7)c(255,1,7)c(255,2,7)......c(255,7,7)\n


		・セル属性ファイル（***.cel^）

		テキスト形式．
		サイズは不定．
		セル番号０から順に セルの属性名を保存したもの．属性の与えられて
		いないセルについては保存していない．

		    ＜ATTR＞
			説明
			    セルの属性名を設定する．属性名はセル番号の２キャラ
			    後から行末までである．
			書式
				ATTR	no.	attribute
				 ^       ^       ^
				 |       |       |
				宣言  セル番号  属性名

		    ＜#＞
			説明
			    このコマンドから行末までをコメントとして扱う．
			書式
				#	this line is comment.

		    ＜END＞
			説明
			    セル属性ファイルの終端を表す．
			書式
				END

	・ファイルの保守について

	    現段階（Ver.1.01）ではファイルの保守についてはまったく行われていま
	せん．したがって，ファイルの入出力時のファイル名入力あるいはテキスト
	エディタによるファイルの編集には注意をしてください．ファイルの保守に
	ついての具体的な問題点は以下の通りです．

		・編集コマンド入力中のファイル名にはサフィックスの自動付加が
		  されていない．
		・データファイルの読み込み時に EOF をチェックしていないので
		  ファイルのサイズがおかしい場合（テキストエディタなどで編集
		  し直したファイルなど）に Bus error がでて編集作業を終了し
		  てしまうことがある．
		・データファイルの書き込み時にファイル名入力をさせているにも
		  かかわらず，上書き確認の表示がないため入力したファイル名に
		  よっては，期せずして他のファイルの内容を消してしまう可能性
		  がある．

	・今後のバージョンアップについて

	    今後の改良点は

		・ウインドウマネージャによって変更されたウインドウの位置は現在
		検出できないので，検出できるようにする（XGetGeometry の調子が
		悪い）．
		・カラーファイルの編集機能を追加する．
		・ファイルの保守関連の処理を追加する．
		・いくつかの画像フォーマットに対応させる．
		・プログラムを整理して見やすくする．

５．注意

    プログラム me の実行によって発生したいかなる故障・破損・損失等についても
一切責任を負いかねますのでご了承下さい．

						1994 / 10 / 25 ( ver.1.01 )
